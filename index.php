<?php session_start();error_reporting(E_ALL);ini_set('display_errors',1);$db_config=['host'=>'localhost','user'=>'gold24_user','pass'=>'random_password','name'=>'gold24_db'];$conn=new mysqli($db_config['host'],$db_config['user'],$db_config['pass'],$db_config['name']);$conn->set_charset("utf8mb4");if($conn->connect_error){die("Connection failed: ".$conn->connect_error);}$errorMessage='';$successMessage='';if($_SERVER['REQUEST_METHOD']=='POST'){$action=$_POST['action'];$email=trim($_POST['email']);$password=trim($_POST['password']);if($action=='register'){$name=trim($_POST['name']);$confirmPassword=trim($_POST['confirm_password']);$uid=trim($_POST['uid']);if(empty($name)||empty($email)||empty($password)||empty($confirmPassword)||empty($uid)){$errorMessage="تمامی فیلدها الزامی هستند!";}elseif(!preg_match('/^[a-zA-Z]+$/',$name)){$errorMessage="نام فقط باید شامل حروف لاتین باشد.";}elseif(!preg_match('/^\d+$/',$uid)){$errorMessage="UID فقط باید شامل اعداد باشد.";}elseif($password!==$confirmPassword){$errorMessage="رمز عبور و تایید رمز عبور یکسان نیستند!";}else{$stmt=$conn->prepare("SELECT id FROM users WHERE email=? OR uid=?");$stmt->bind_param("ss",$email,$uid);$stmt->execute();$stmt->store_result();if($stmt->num_rows>0){$errorMessage="این ایمیل یا UID قبلاً ثبت شده است!";}else{$hashed_password=password_hash($password,PASSWORD_DEFAULT);$user_uid=uniqid();$stmt=$conn->prepare("INSERT INTO users (name,email,password,uid,user_uid) VALUES (?,?,?,?,?)");$stmt->bind_param("sssss",$name,$email,$hashed_password,$uid,$user_uid);if($stmt->execute()){$successMessage="ثبت‌نام موفقیت‌آمیز بود! لطفاً وارد شوید.";}else{$errorMessage="خطا در ثبت نام: ".$stmt->error;}}$stmt->close();}}elseif($action=='login'){$stmt=$conn->prepare("SELECT id,name,password,uid,user_uid FROM users WHERE email=?");$stmt->bind_param("s",$email);$stmt->execute();$result=$stmt->get_result();if($result->num_rows>0){$user=$result->fetch_assoc();if(password_verify($password,$user['password'])){$_SESSION['user_id']=$user['id'];$_SESSION['user_name']=$user['name'];$_SESSION['user_uid']=$user['user_uid'];$_SESSION['email']=$email;$_SESSION['username']=$user['name'];if(!headers_sent()){header("Location: /English/index.php");exit();}else{echo"<script>window.location.href='/English/index.php';</script>";exit();}}else{$errorMessage="رمز عبور اشتباه است!";}}else{$errorMessage="کاربری با این ایمیل یافت نشد!";}$stmt->close();}}$conn->close();?><!DOCTYPE html><html lang="fa" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Gold24 - ورود/ثبت‌نام</title><style>:root{--primary:#654321;--secondary:#8B4513;--accent:#D2691E;--background:#1C1C1C;--card-bg:#2B1B17;--text:#FFF;--gold:#FFD700}*{box-sizing:border-box;margin:0;padding:0}body{background:var(--background);font-family:'Vazirmatn',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;color:var(--text)}.container{background:var(--card-bg);padding:30px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.3);width:400px;max-width:90%;position:relative}.container::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(to right,var(--gold),var(--accent))}.header{text-align:center;font-size:24px;color:var(--gold);margin-bottom:25px;font-weight:bold;text-shadow:2px 2px 4px rgba(0,0,0,0.5)}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;color:#C0C0C0}.form-group input{width:100%;padding:12px;border:1px solid var(--primary);border-radius:8px;background:#3A3A3A;color:white;font-size:15px;transition:all 0.3s}.form-group input:focus{border-color:var(--gold);outline:none;box-shadow:0 0 0 2px rgba(255,215,0,0.2)}.btn{width:100%;padding:12px;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;transition:0.3s;text-align:center}.btn-primary{background:linear-gradient(45deg,var(--gold),#FFA500);color:#000}.btn-primary:hover{background:linear-gradient(45deg,#FFA500,var(--gold));transform:translateY(-2px)}.btn-secondary{background:none;border:1px solid var(--gold);color:var(--gold);margin-top:10px}.btn-secondary:hover{background:rgba(255,215,0,0.1)}.message{padding:10px;margin:10px 0;border-radius:6px;text-align:center;font-size:14px}.error{background:rgba(139,0,0,0.2);color:#FF6347;border:1px solid rgba(139,0,0,0.3)}.success{background:rgba(0,128,0,0.2);color:#90EE90;border:1px solid rgba(0,128,0,0.3)}@media(max-width:480px){.container{padding:20px}.header{font-size:20px}.form-group input{padding:10px}}</style></head><body><div class="container"><div class="header">Gold24</div><form id="authForm" method="POST"><input type="hidden" id="formAction" name="action" value="login"><div id="nameGroup" style="display:none" class="form-group"><label>نام:</label><input type="text" name="name" pattern="[A-Za-z]+" title="فقط حروف لاتین مجاز است"></div><div class="form-group"><label>ایمیل:</label><input type="email" name="email" required></div><div class="form-group"><label>رمز عبور:</label><input type="password" name="password" required></div><div id="confirmGroup" style="display:none" class="form-group"><label>تکرار رمز عبور:</label><input type="password" name="confirm_password"></div><div id="uidGroup" style="display:none" class="form-group"><label>کد کاربری (فقط عدد):</label><input type="text" name="uid" pattern="[0-9]+" title="فقط اعداد مجاز است"></div><button type="submit" class="btn btn-primary" id="submitBtn">ورود</button></form><button onclick="toggleForm()" class="btn btn-secondary" id="toggleBtn">ثبت‌نام</button><?php if($errorMessage):?><div class="message error"><?php echo$errorMessage;?></div><?php endif;?><?php if($successMessage):?><div class="message success"><?php echo$successMessage;?></div><?php endif;?></div><script>function toggleForm(){const isLogin=document.getElementById('formAction').value==='login';document.getElementById('formAction').value=isLogin?'register':'login';document.getElementById('nameGroup').style.display=isLogin?'block':'none';document.getElementById('confirmGroup').style.display=isLogin?'block':'none';document.getElementById('uidGroup').style.display=isLogin?'block':'none';document.getElementById('submitBtn').textContent=isLogin?'ثبت‌نام':'ورود';document.getElementById('toggleBtn').textContent=isLogin?'ورود':'ثبت‌نام';}</script></body></html>
